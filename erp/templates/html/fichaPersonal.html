{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ficha de Ingreso del Personal</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/stylesPersonal.css' %}" />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="{% static 'js/scriptPersonal.js' %}"></script>
    <style>
      /* Estilos CSS para dar formato a la página */
      body {
        font-family: Arial, sans-serif;
      }
      
      .section {
        margin: 20px 0;
      }
      
      .textbox {
        width: 300px;
        padding: 5px;
        margin: 5px;
        border-radius: 10px;
        background-color: #01152a;
        color: white;
      }
      
      .date-input {
        width: 150px;
        padding: 5px;
        margin: 5px;
        border-radius: 10px;
        background-color: #01152a;
        color: white;
      }
      
      img {
        max-width: 200%;
        height: auto;
      }
      
      @media only screen and (min-width: 600px) {
        .textbox,
        .date-input {
          width: 300px;
        }
      }
      
      @media only screen and (max-width: 600px) {
        .textbox,
        .date-input {
          width: calc(100% - 10px);
        }
      }
    </style>
  </head>
  <body>
    <h1>Ficha de Ingreso del Personal</h1>
    <div class="imagen-container">
      <img src="{% static 'images/lineaRoja.png' %}" />
    </div>

    <form method="post" id="fichaPersonalForm">
      {% csrf_token %}
      <div class="section">
        <input type="text" class="textbox" name="apellidoPaterno" id="apellidoPaterno" placeholder="Apellido Paterno" />
        <input type="text" class="textbox" name="apellidoMaterno" placeholder="Apellido Materno" />
        <input type="text" class="textbox" name="nombres" placeholder="Nombres" />
        <input type="text" class="textbox" name="rut" placeholder="Rut" />

        <!-- Selector desplegable para Estado Civil -->
        <select class="textbox" name="estadoCivil">
          <option value="">Selecciona Estado Civil</option>
          <option value="Soltero">Soltero</option>
          <option value="Casado">Casado</option>
          <option value="Viudo">Viudo</option>
        </select>

        <input type="text" class="textbox" name="nacionalidad" placeholder="Nacionalidad" />
        <input type="text" class="textbox" name="direccion" placeholder="Dirección" />
        <input type="text" class="textbox" name="comuna" placeholder="Comuna" />
        <input type="text" class="textbox" name="correoElectronico" placeholder="Correo Electrónico" />
        <input type="text" class="textbox" name="celular" placeholder="Celular" />

        <!-- Calendario para Fecha de Nacimiento -->
        <input type="date" class="textbox" name="fechaNacimiento" />
      </div>

      <div class="section">
        <h2>Antecedentes Previsionales</h2>
        <div class="subCasoEmergencia">
          <img src="{% static 'images/lineaRoja.png' %}" />
        </div>
        <input type="text" class="textbox" name="afp" placeholder="AFP" />
        <input type="text" class="textbox" name="salud" placeholder="Salud" />
        <input type="text" class="textbox" name="otros" placeholder="Otros" />
      </div>

      <div class="section">
        <h2>Antecedentes Bancarios</h2>
        <div class="subrayadoAntecedentes">
          <img src="{% static 'images/lineaRoja.png' %}" />
        </div>
        <input type="text" class="textbox" name="tipoCuenta" placeholder="Tipo de Cuenta" />
        <input type="text" class="textbox" name="numeroCuenta" placeholder="Nº de Cuenta" />
        <!-- Selector desplegable para Banco -->
        <select class="textbox" name="banco">
          <option value="">Selecciona Banco</option>
          <option value="BCI">BCI</option>
          <option value="Banco Estado">Banco Estado</option>
        </select>
      </div>

      <div class="section">
        <h2>Contacto en Caso de Emergencia</h2>
        <div class="subCasoEmergencia">
          <img src="{% static 'images/lineaRoja.png' %}" />
        </div>
        <input type="text" class="textbox" name="contactoEmergencia" placeholder="Nombre y Apellido" />
        <input type="text" class="textbox" name="celularEmergencia" placeholder="Celular" />
        <input type="text" class="textbox" name="parentescoEmergencia" placeholder="Parentesco" />
      </div>

      <div class="section">
        <h2>Hijos</h2>
        <img src="{% static 'images/lineaRoja.png' %}" />
        <table id="TablaHijos">
          <thead style="background-color: transparent;">
            <tr>
              <th>Nombre</th>
              <th>Rut</th>
              <th>Apellido Paterno</th>
              <th>Apellido Materno</th>
              <th>Nombres</th>
              <th>Fecha de Nacimiento</th>
              <th>Parentesco</th>
              <th>Sexo</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Hijos</td>
              <td>
                <input type="text" class="textbox" name="rutHijo" placeholder="Rut" />
              </td>
              <td>
                <input type="text" class="textbox" name="apellidoPaternoHijo" placeholder="Apellido Paterno" />
              </td>
              <td>
                <input type="text" class="textbox" name="apellidoMaternoHijo" placeholder="Apellido Materno" />
              </td>
              <td>
                <input type="text" class="textbox" name="nombresHijo" placeholder="Nombres" />
              </td>
              <td>
                <input type="date" class="textbox" name="fechaNacimientoHijo" />
              </td>
              <td>
                <input type="text" class="textbox" name="parentescoHijo" placeholder="Parentesco" />
              </td>
              <td>
                <select class="textbox" name="sexoHijo">
                  <option value="">Selecciona Sexo</option>
                  <option value="Masculino">Masculino</option>
                  <option value="Femenino">Femenino</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
        <button type="button" id="agregarHijo">Agregar</button>

        <script>
          document.getElementById('agregarHijo').addEventListener('click', function () {
            const table = document.getElementById('TablaHijos').getElementsByTagName('tbody')[0]
            const newRow = table.insertRow(-1) // Insertar al final
          
            const columnCount = 9
          
            for (let i = 0; i < columnCount; i++) {
              const cell = newRow.insertCell(i)
          
              if (i === 0) {
                cell.innerHTML = 'Hijo/a'
              } else if (i === columnCount - 1) {
                // La última columna es el selector de sexo
                const select = document.createElement('select')
                select.className = 'textbox'
                select.classList.add('sexo') // Clase para identificar el selector de sexo
                const options = ['Selecciona Sexo', 'Masculino', 'Femenino']
                options.forEach((optionText) => {
                  const option = document.createElement('option')
                  option.value = optionText
                  option.text = optionText
                  select.appendChild(option)
                })
                cell.appendChild(select)
              } else {
                const input = document.createElement('input')
                input.type = 'text'
                input.className = 'textbox'
          
                if (i === 1) {
                  input.classList.add('rut') // Clase para identificar el campo de Rut
                  input.placeholder = 'Rut'
                } else if (i === 2) {
                  input.classList.add('apellidoPaterno') // Clase para identificar el campo de Apellido Paterno
                  input.placeholder = 'Apellido Paterno'
                } else if (i === 3) {
                  input.classList.add('apellidoMaterno') // Clase para identificar el campo de Apellido Materno
                  input.placeholder = 'Apellido Materno'
                } else if (i === 4) {
                  input.classList.add('nombresHijo') // Clase para identificar el campo de Nombres
                  input.placeholder = 'Nombres'
                } else if (i === 5) {
                  input.type = 'date'
                  input.classList.add('fechaNacimientoHijo') // Clase para identificar el campo de Fecha de Nacimiento
                } else if (i === 6) {
                  input.classList.add('parentescoHijo') // Clase para identificar el campo de Parentesco
                  input.placeholder = 'Parentesco'
                } else if (i === 7) {
                  // Campo de Sexo para el hijo
                  const select = document.createElement('select')
                  select.className = 'textbox'
                  select.classList.add('sexoHijo') // Clase para identificar el selector de sexo
                  const options = ['Selecciona Sexo', 'Masculino', 'Femenino']
                  options.forEach((optionText) => {
                    const option = document.createElement('option')
                    option.value = optionText
                    option.text = optionText
                    select.appendChild(option)
                  })
                  cell.appendChild(select)
                  return
                }
                cell.appendChild(input)
              }
            }
          })
        </script>
      </div>

      <div class="section">
        <h2>Solicitud EPP</h2>
        <img src="{% static 'images/lineaRoja.png' %}" />
        <table id="tablaElementos">
          <thead style="background-color: transparent;">
            <tr>
              <th>Talla Polera</th>
              <th>Talla Pantalon</th>
              <th>Calzado Seguridad</th>
              <th>Talla Overol</th>
              <th>Talla Traje de Agua</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <select class="textbox" name="tallaPolera">
                  <option value="">Selecciona Talla</option>
                  <option value="S">S</option>
                  <option value="M">M</option>
                  <option value="L">L</option>
                  <option value="XL">XL</option>
                </select>
              </td>
              <td>
                <select class="textbox" name="tallaPantalon">
                  <option value="">Selecciona Talla</option>
                  <option value="S">S</option>
                  <option value="M">M</option>
                  <option value="L">L</option>
                  <option value="XL">XL</option>
                </select>
              </td>
              <td>
                <input type="number" class="textbox" name="calzadoSeguridad" placeholder="Calzado" />
              </td>
              <td>
                <select class="textbox" name="tallaOverol">
                  <option value="">Selecciona Talla</option>
                  <option value="S">S</option>
                  <option value="M">M</option>
                  <option value="L">L</option>
                  <option value="XL">XL</option>
                </select>
              </td>
              <td>
                <select class="textbox" name="tallaTrajeDeAgua">
                  <option value="">Selecciona Talla</option>
                  <option value="S">S</option>
                  <option value="M">M</option>
                  <option value="L">L</option>
                  <option value="XL">XL</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="section">
        <h2>Documentacion Adjuntada</h2>
        <img src="{% static 'images/lineaRoja.png' %}" />
      </div>

      <div class="document-box">
        <input type="file" name="file-input" id="file-input" accept=".pdf, .doc, .docx" />
        <label for="file-input" class="custom-file-upload">Seleccionar documento</label>
        <div id="file-name"></div>
        <ul id="document-list"></ul>
      </div>

      <h3></h3>
      <button type="button" id="GuardarFicha">Guardar Ficha</button>
    </form>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
      $(document).ready(function () {
        $('#GuardarFicha').on('click', function (event) {
          event.preventDefault()
      
          $.ajax({
            type: 'POST',
            url: '{% url "erp:nueva_fichaPersonal" %}',
            data: $('#fichaPersonalForm').serialize(),
            success: function (data) {
              console.log('Datos a enviar:', $('#fichaPersonalForm').serialize())
              console.log('Respuesta del servidor:', data)
      
              if (data.redirect_url) {
                console.log('Redireccionando a:', data.redirect_url)
                window.location.href = data.redirect_url
              } else {
                console.error('La respuesta no contiene una URL de redirección.')
              }
            },
            error: function (xhr, textStatus, errorThrown) {
              console.log('Error en la solicitud:', textStatus)
              console.log('Detalles del error:', xhr.responseText)
            }
          })
        })
      })
    </script>
  </body>
</html>
